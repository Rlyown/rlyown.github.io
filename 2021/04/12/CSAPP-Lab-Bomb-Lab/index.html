<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>CSAPP Lab -- Bomb Lab - Real Own</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Chaos Chen"><meta name="msapplication-TileImage" content="/img/f7.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Chaos Chen"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="记录Bomb Lab的实验过程"><meta property="og:type" content="blog"><meta property="og:title" content="CSAPP Lab -- Bomb Lab"><meta property="og:url" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/"><meta property="og:site_name" content="Real Own"><meta property="og:description" content="记录Bomb Lab的实验过程"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406223430022.png"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406235453267.png"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407153921834.png"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407160332223.png"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412161144084.png"><meta property="og:image" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412181935636.png"><meta property="article:published_time" content="2021-04-12T10:42:20.000Z"><meta property="article:modified_time" content="2023-06-30T08:53:26.355Z"><meta property="article:author" content="Chaos Chen"><meta property="article:tag" content="CSAPP"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406223430022.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/"},"headline":"CSAPP Lab -- Bomb Lab","image":["https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406223430022.png","https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406235453267.png","https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407153921834.png","https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407160332223.png","https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412161144084.png","https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412181935636.png"],"datePublished":"2021-04-12T10:42:20.000Z","dateModified":"2023-06-30T08:53:26.355Z","author":{"@type":"Person","name":"Chaos Chen"},"publisher":{"@type":"Organization","name":"Real Own","logo":{"@type":"ImageObject","url":"https://rlyown.github.io/img/f7.png"}},"description":"记录Bomb Lab的实验过程"}</script><link rel="canonical" href="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/"><link rel="alternate" href="/atom.xml" title="Real Own" type="application/atom+xml"><link rel="icon" href="/img/f7.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oxanium:wght@300;400;600&amp;family=Roboto+Mono"><link rel="stylesheet" href="/css/cyberpunk.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/f7.png" alt="Real Own" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/Rlyown/rlyown.github.io"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catálogo" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Buscar" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Publicado hace&nbsp;<time dateTime="2021-04-12T10:42:20.000Z" title="4/12/2021, 6:42:20 PM">2021-04-12</time></span><span class="level-item">Actualizado hace&nbsp;<time dateTime="2023-06-30T08:53:26.355Z" title="6/30/2023, 4:53:26 PM">2023-06-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Operating-System/">Operating System</a></span><span class="level-item">29 minutes de lectura (Aproximadamente 4390 palabras)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>&nbsp;visitas</span></div></div><h1 class="title is-3 is-size-4-mobile">CSAPP Lab -- Bomb Lab</h1><div class="content"><p>使用objdump工具对程序进行反汇编。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">objdump -s -d bomb &gt; bomb.out  <span class="comment"># 可执行指令部分反汇编</span></span><br><span class="line">objdump -s -j .data bomb &gt; bomb.data  <span class="comment"># 获取data段</span></span><br><span class="line">objdump -s -j .rodata bomb &gt; bomb.rodata  <span class="comment"># 获取rodata段</span></span><br></pre></td></tr></table></figure>

<h2 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase 1"></a>Phase 1</h2><p>找到Phase_1部分的汇编代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 phase_1:</span><br><span class="line">  400ee0: 48 83 ec 08                  	subq	$8, %rsp</span><br><span class="line">  400ee4: be 00 24 40 00               	movl	$4203520, %esi</span><br><span class="line">  400ee9: e8 4a 04 00 00               	callq	1098 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee: 85 c0                        	testl	%eax, %eax</span><br><span class="line">  400ef0: 74 05                        	je	5 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2: e8 43 05 00 00               	callq	1347 &lt;explode_bomb&gt;</span><br><span class="line">  400ef7: 48 83 c4 08                  	addq	$8, %rsp</span><br><span class="line">  400efb: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>对它以及调用它的上下文简单分析可以将它转为下列C语言代码。（部分强大的反汇编工具允许生成C语言代码，这里建议自己手动尝试）</p>
<blockquote>
<p>Test指令用于将两个操作数进行与操作，然后根据结果设置标志寄存器。JE指令表示ZF被置位时跳转。</p>
<p>这里的作用是检测eax是否为0，如果与的结果为0，则ZF置位。如果ZF被置位则跳转到&lt;phase_1+0x17&gt;的位置。</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">phase_1(<span class="type">char</span> *input) &#123;</span><br><span class="line">    <span class="type">int</span> r = strings_not_equal(input, <span class="number">4203520</span>);</span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span>) &#123;  </span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>strings_not_equal方法可以猜测是一个是一个字符串比较函数，因此可以猜测4203520（0x402400）是一个地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># objdump -s -j .rodata bomb</span><br><span class="line">402400 426f7264 65722072 656c6174 696f6e73  Border relations</span><br><span class="line">402410 20776974 68204361 6e616461 20686176   with Canada hav</span><br><span class="line">402420 65206e65 76657220 6265656e 20626574  e never been bet</span><br><span class="line">402430 7465722e 00000000 576f7721 20596f75  ter.....Wow! You</span><br><span class="line">402440 27766520 64656675 73656420 74686520  &#x27;ve defused the</span><br><span class="line">402450 73656372 65742073 74616765 2100666c  secret stage!.fl</span><br><span class="line">402460 79657273 00000000 00000000 00000000  yers............</span><br></pre></td></tr></table></figure>

<p>从中地址4203520提取出字符串“Border relations with Canada have never been better.”（字符串以0x00结束）。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406223430022.png" class="">

<p>此处补充一下strings_not_equal的逻辑，可以根据汇编代码得出下列结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">strings_not_equal</span><span class="params">(<span class="type">char</span> *input, <span class="type">char</span> *str)</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strlen</span>(input) != <span class="built_in">strlen</span>(str)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (*input != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (*input == *str) &#123;</span><br><span class="line">            input++;</span><br><span class="line">            str++;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase 2"></a>Phase 2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0000000000400efc phase_2:</span><br><span class="line">  400efc: 55                           	pushq	%rbp</span><br><span class="line">  400efd: 53                           	pushq	%rbx</span><br><span class="line">  400efe: 48 83 ec 28                  	subq	$40, %rsp</span><br><span class="line">  400f02: 48 89 e6                     	movq	%rsp, %rsi</span><br><span class="line">  400f05: e8 52 05 00 00               	callq	1362 &lt;read_six_numbers&gt;</span><br><span class="line">  400f0a: 83 3c 24 01                  	cmpl	$1, (%rsp)</span><br><span class="line">  400f0e: 74 20                        	je	32 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f10: e8 25 05 00 00               	callq	1317 &lt;explode_bomb&gt;</span><br><span class="line">  400f15: eb 19                        	jmp	25 &lt;phase_2+0x34&gt;</span><br><span class="line">  400f17: 8b 43 fc                     	movl	-4(%rbx), %eax</span><br><span class="line">  400f1a: 01 c0                        	addl	%eax, %eax</span><br><span class="line">  400f1c: 39 03                        	cmpl	%eax, (%rbx)</span><br><span class="line">  400f1e: 74 05                        	je	5 &lt;phase_2+0x29&gt;</span><br><span class="line">  400f20: e8 15 05 00 00               	callq	1301 &lt;explode_bomb&gt;</span><br><span class="line">  400f25: 48 83 c3 04                  	addq	$4, %rbx</span><br><span class="line">  400f29: 48 39 eb                     	cmpq	%rbp, %rbx</span><br><span class="line">  400f2c: 75 e9                        	jne	-23 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f2e: eb 0c                        	jmp	12 &lt;phase_2+0x40&gt;</span><br><span class="line">  400f30: 48 8d 5c 24 04               	leaq	4(%rsp), %rbx</span><br><span class="line">  400f35: 48 8d 6c 24 18               	leaq	24(%rsp), %rbp</span><br><span class="line">  400f3a: eb db                        	jmp	-37 &lt;phase_2+0x1b&gt;</span><br><span class="line">  400f3c: 48 83 c4 28                  	addq	$40, %rsp</span><br><span class="line">  400f40: 5b                           	popq	%rbx</span><br><span class="line">  400f41: 5d                           	popq	%rbp</span><br><span class="line">  400f42: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>同样对它进行翻译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">phase_2(<span class="type">char</span> *input) &#123;</span><br><span class="line">    %rsp -= <span class="number">40</span></span><br><span class="line">    read_six_number(input, %rsp - <span class="number">40</span>);</span><br><span class="line">    <span class="keyword">if</span> (*(%rsp) != <span class="number">1</span>) &#123;</span><br><span class="line">		explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    %rbx = %rsp + <span class="number">4</span>;</span><br><span class="line">    %rbp = %rsp + <span class="number">24</span>;</span><br><span class="line">loop:</span><br><span class="line">    %eax = *(%rbx - <span class="number">4</span>) * <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (%eax != *(%rbx)) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    %rbx += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> (%rbp != %rbx) &#123;</span><br><span class="line">        <span class="keyword">goto</span> loop;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很容易看出来，比较6个数。已经规定了第一个数是1，要求每个后面的数，都是前一个数的两倍。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210406235453267.png" class="">

<h2 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase 3"></a>Phase 3</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 phase_3:</span><br><span class="line">  400f43: 48 83 ec 18                  	subq	$24, %rsp</span><br><span class="line">  400f47: 48 8d 4c 24 0c               	leaq	12(%rsp), %rcx</span><br><span class="line">  400f4c: 48 8d 54 24 08               	leaq	8(%rsp), %rdx</span><br><span class="line">  400f51: be cf 25 40 00               	movl	$4203983, %esi</span><br><span class="line">  400f56: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  400f5b: e8 90 fc ff ff               	callq	-880 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  400f60: 83 f8 01                     	cmpl	$1, %eax</span><br><span class="line">  400f63: 7f 05                        	jg	5 &lt;phase_3+0x27&gt;</span><br><span class="line">  400f65: e8 d0 04 00 00               	callq	1232 &lt;explode_bomb&gt;</span><br><span class="line">  400f6a: 83 7c 24 08 07               	cmpl	$7, 8(%rsp)</span><br><span class="line">  400f6f: 77 3c                        	ja	60 &lt;phase_3+0x6a&gt;</span><br><span class="line">  400f71: 8b 44 24 08                  	movl	8(%rsp), %eax</span><br><span class="line">  400f75: ff 24 c5 70 24 40 00         	jmpq	*4203632(,%rax,8)  # switch跳转表</span><br><span class="line">  400f7c: b8 cf 00 00 00               	movl	$207, %eax</span><br><span class="line">  400f81: eb 3b                        	jmp	59 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f83: b8 c3 02 00 00               	movl	$707, %eax</span><br><span class="line">  400f88: eb 34                        	jmp	52 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f8a: b8 00 01 00 00               	movl	$256, %eax</span><br><span class="line">  400f8f: eb 2d                        	jmp	45 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f91: b8 85 01 00 00               	movl	$389, %eax</span><br><span class="line">  400f96: eb 26                        	jmp	38 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f98: b8 ce 00 00 00               	movl	$206, %eax</span><br><span class="line">  400f9d: eb 1f                        	jmp	31 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f9f: b8 aa 02 00 00               	movl	$682, %eax</span><br><span class="line">  400fa4: eb 18                        	jmp	24 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fa6: b8 47 01 00 00               	movl	$327, %eax</span><br><span class="line">  400fab: eb 11                        	jmp	17 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fad: e8 88 04 00 00               	callq	1160 &lt;explode_bomb&gt;</span><br><span class="line">  400fb2: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  400fb7: eb 05                        	jmp	5 &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fb9: b8 37 01 00 00               	movl	$311, %eax</span><br><span class="line">  400fbe: 3b 44 24 0c                  	cmpl	12(%rsp), %eax</span><br><span class="line">  400fc2: 74 05                        	je	5 &lt;phase_3+0x86&gt;</span><br><span class="line">  400fc4: e8 71 04 00 00               	callq	1137 &lt;explode_bomb&gt;</span><br><span class="line">  400fc9: 48 83 c4 18                  	addq	$24, %rsp</span><br><span class="line">  400fcd: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>同样进行翻译，先说结论，其解释在后面。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">phase_3 (<span class="type">char</span> *input) &#123;</span><br><span class="line">    <span class="type">int</span> r = __isoc99_sscanf(input, <span class="number">4203983</span>， %rsp + <span class="number">8</span>, %rsp + <span class="number">12</span>);</span><br><span class="line">    <span class="keyword">if</span> (r &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (*(%rsp + <span class="number">8</span>) &gt; <span class="number">7</span>) &#123;</span><br><span class="line">        <span class="keyword">goto</span> tag_1;</span><br><span class="line">    &#125;</span><br><span class="line">    %eax = *(%rsp + <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">switch</span>(%eax) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            %eax = <span class="number">207</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            %eax = <span class="number">311</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            %eax = <span class="number">707</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            %eax = <span class="number">256</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            %eax = <span class="number">389</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">            %eax = <span class="number">206</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">            %eax = <span class="number">682</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">            %eax = <span class="number">327</span>;</span><br><span class="line">            <span class="keyword">goto</span> tag_2;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">tag_1:</span><br><span class="line">    explode_bomb();</span><br><span class="line">    %eax = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">goto</span> tag_2;</span><br><span class="line"></span><br><span class="line">tag_2:</span><br><span class="line">    <span class="keyword">if</span> (%eax == *(%rsp + <span class="number">12</span>)) &#123;</span><br><span class="line">        <span class="keyword">goto</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    explode_bomb();</span><br><span class="line">ret:</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先来看下输入给__isoc99_sscanf的字符串，即“%d %d”。即从input中读取两个数，到%esp + 8和%esp + 12的位置。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407153921834.png" class="">

<p>根据指令<code>jmpq	*4203632(,%rax,8)</code>，以及下列一系列的操作可以判断是一个switch语句，然后根据这个地址找到switch的跳转表。找到跳转表之后就可以根据%rax的值来还原case的情况。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210407160332223.png" class="">

<p>最后就很简单了，输入两个数，让第一个数对应的case获得的值等于第二个数。</p>
<h2 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase 4"></a>Phase 4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c phase_4:</span><br><span class="line">  40100c: 48 83 ec 18                  	subq	$24, %rsp</span><br><span class="line">  401010: 48 8d 4c 24 0c               	leaq	12(%rsp), %rcx</span><br><span class="line">  401015: 48 8d 54 24 08               	leaq	8(%rsp), %rdx</span><br><span class="line">  40101a: be cf 25 40 00               	movl	$4203983, %esi</span><br><span class="line">  40101f: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  401024: e8 c7 fb ff ff               	callq	-1081 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  401029: 83 f8 02                     	cmpl	$2, %eax</span><br><span class="line">  40102c: 75 07                        	jne	7 &lt;phase_4+0x29&gt; # 0x401035</span><br><span class="line">  40102e: 83 7c 24 08 0e               	cmpl	$14, 8(%rsp)</span><br><span class="line">  401033: 76 05                        	jbe	5 &lt;phase_4+0x2e&gt; # 0x40103a</span><br><span class="line">  401035: e8 00 04 00 00               	callq	1024 &lt;explode_bomb&gt;</span><br><span class="line">  40103a: ba 0e 00 00 00               	movl	$14, %edx</span><br><span class="line">  40103f: be 00 00 00 00               	movl	$0, %esi</span><br><span class="line">  401044: 8b 7c 24 08                  	movl	8(%rsp), %edi</span><br><span class="line">  401048: e8 81 ff ff ff               	callq	-127 &lt;func4&gt;</span><br><span class="line">  40104d: 85 c0                        	testl	%eax, %eax</span><br><span class="line">  40104f: 75 07                        	jne	7 &lt;phase_4+0x4c&gt; # 0x401058</span><br><span class="line">  401051: 83 7c 24 0c 00               	cmpl	$0, 12(%rsp)</span><br><span class="line">  401056: 74 05                        	je	5 &lt;phase_4+0x51&gt; # 0x40105d</span><br><span class="line">  401058: e8 dd 03 00 00               	callq	989 &lt;explode_bomb&gt;</span><br><span class="line">  40105d: 48 83 c4 18                  	addq	$24, %rsp</span><br><span class="line">  401061: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>解释称对应的C语言：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">phase_4 (<span class="type">char</span> *input) &#123;</span><br><span class="line">	<span class="type">int</span> r = __isoc99_sscanf(input, <span class="number">4203983</span>, %rsp + <span class="number">8</span>, %rsp + <span class="number">12</span>);  <span class="comment">// 跟phase_3一样读取两个数</span></span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">2</span> || *(%rsp + <span class="number">8</span>) &gt; <span class="number">14</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    r = func4(*(%rsp + <span class="number">8</span>), <span class="number">0</span>, <span class="number">14</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (r != <span class="number">0</span> || *(%rsp + <span class="number">12</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看来还需要进一步关注func4的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce func4:</span><br><span class="line">  400fce: 48 83 ec 08                  	subq	$8, %rsp</span><br><span class="line">  400fd2: 89 d0                        	movl	%edx, %eax</span><br><span class="line">  400fd4: 29 f0                        	subl	%esi, %eax</span><br><span class="line">  400fd6: 89 c1                        	movl	%eax, %ecx</span><br><span class="line">  400fd8: c1 e9 1f                     	shrl	$31, %ecx</span><br><span class="line">  400fdb: 01 c8                        	addl	%ecx, %eax</span><br><span class="line">  400fdd: d1 f8                        	sarl	%eax</span><br><span class="line">  400fdf: 8d 0c 30                     	leal	(%rax,%rsi), %ecx</span><br><span class="line">  400fe2: 39 f9                        	cmpl	%edi, %ecx</span><br><span class="line">  400fe4: 7e 0c                        	jle	12 &lt;func4+0x24&gt; # 0x400ff2</span><br><span class="line">  400fe6: 8d 51 ff                     	leal	-1(%rcx), %edx</span><br><span class="line">  400fe9: e8 e0 ff ff ff               	callq	-32 &lt;func4&gt;</span><br><span class="line">  400fee: 01 c0                        	addl	%eax, %eax</span><br><span class="line">  400ff0: eb 15                        	jmp	21 &lt;func4+0x39&gt; # 0x401007</span><br><span class="line">  400ff2: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  400ff7: 39 f9                        	cmpl	%edi, %ecx</span><br><span class="line">  400ff9: 7d 0c                        	jge	12 &lt;func4+0x39&gt; # 0x401007</span><br><span class="line">  400ffb: 8d 71 01                     	leal	1(%rcx), %esi</span><br><span class="line">  400ffe: e8 cb ff ff ff               	callq	-53 &lt;func4&gt;</span><br><span class="line">  401003: 8d 44 00 01                  	leal	1(%rax,%rax), %eax</span><br><span class="line">  401007: 48 83 c4 08                  	addq	$8, %rsp</span><br><span class="line">  40100b: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>同样对其进行解析，大致可以看出来func4做的是一个二分查找，在y和z中间查找x，并且返回搜索的次数。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">func4(%edi, %esi, %edx) &#123;</span><br><span class="line">    %eax = %edx - %esi;</span><br><span class="line">    </span><br><span class="line">	%ecx = %eax &gt;&gt; <span class="number">31</span>;  <span class="comment">// 严格来说不能这么写，shrl代表的是逻辑右移，而不是算数右移</span></span><br><span class="line">    				    <span class="comment">// 在C语言中的&gt;&gt;代表的是算数右移</span></span><br><span class="line">    %eax += %ecx;</span><br><span class="line">    </span><br><span class="line">    %eax &gt;&gt;= <span class="number">1</span>; 		<span class="comment">// 这里sarl就是算数右移</span></span><br><span class="line">    </span><br><span class="line">    %ecx = %rax + %rsi;  <span class="comment">// %ecx这里就代表的是中间数mid = l + (r - l) / 2</span></span><br><span class="line">    <span class="keyword">if</span> (%ecx &lt;= %edi) &#123;  <span class="comment">// if mid &lt;= target</span></span><br><span class="line">        %eax = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">if</span> (%ecx &gt;= %edi) &#123; <span class="comment">// if mid == target</span></span><br><span class="line">        	<span class="keyword">return</span> %eax;</span><br><span class="line">   		&#125;</span><br><span class="line">    	%esi = %rcx + <span class="number">1</span>;  <span class="comment">// l = mid + 1</span></span><br><span class="line">    	%eax = func4(%edi, %esi, %edx);</span><br><span class="line">    	%eax = %rax * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;  <span class="comment">// if mid &gt; target</span></span><br><span class="line">        %edx = %rcx - <span class="number">1</span>;  <span class="comment">// r = mid - 1</span></span><br><span class="line">    	%eax = func4(%edi, %esi, %edx);</span><br><span class="line">    	%eax *= <span class="number">2</span>;</span><br><span class="line">    &#125;   </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> %eax;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就很明显了，要使炸弹不爆炸需要输入两个数，第一个数在(0, 14)之间进行二分查找的搜索次数为0，第二数要求为0。</p>
<h2 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase 5"></a>Phase 5</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">0000000000401062 phase_5:</span><br><span class="line">  401062: 53                           	pushq	%rbx</span><br><span class="line">  401063: 48 83 ec 20                  	subq	$32, %rsp</span><br><span class="line">  401067: 48 89 fb                     	movq	%rdi, %rbx</span><br><span class="line">  40106a: 64 48 8b 04 25 28 00 00 00   	movq	%fs:40, %rax</span><br><span class="line">  401073: 48 89 44 24 18               	movq	%rax, 24(%rsp)</span><br><span class="line">  401078: 31 c0                        	xorl	%eax, %eax</span><br><span class="line">  40107a: e8 9c 02 00 00               	callq	668 &lt;string_length&gt;</span><br><span class="line">  40107f: 83 f8 06                     	cmpl	$6, %eax</span><br><span class="line">  401082: 74 4e                        	je	78 &lt;phase_5+0x70&gt;  # 0x4010d2</span><br><span class="line">  401084: e8 b1 03 00 00               	callq	945 &lt;explode_bomb&gt;</span><br><span class="line">  401089: eb 47                        	jmp	71 &lt;phase_5+0x70&gt;  # 0x4010d2</span><br><span class="line">  40108b: 0f b6 0c 03                  	movzbl	(%rbx,%rax), %ecx</span><br><span class="line">  40108f: 88 0c 24                     	movb	%cl, (%rsp)</span><br><span class="line">  401092: 48 8b 14 24                  	movq	(%rsp), %rdx</span><br><span class="line">  401096: 83 e2 0f                     	andl	$15, %edx</span><br><span class="line">  401099: 0f b6 92 b0 24 40 00         	movzbl	4203696(%rdx), %edx</span><br><span class="line">  4010a0: 88 54 04 10                  	movb	%dl, 16(%rsp,%rax)</span><br><span class="line">  4010a4: 48 83 c0 01                  	addq	$1, %rax</span><br><span class="line">  4010a8: 48 83 f8 06                  	cmpq	$6, %rax</span><br><span class="line">  4010ac: 75 dd                        	jne	-35 &lt;phase_5+0x29&gt;  # 0x40108b</span><br><span class="line">  4010ae: c6 44 24 16 00               	movb	$0, 22(%rsp)</span><br><span class="line">  4010b3: be 5e 24 40 00               	movl	$4203614, %esi</span><br><span class="line">  4010b8: 48 8d 7c 24 10               	leaq	16(%rsp), %rdi</span><br><span class="line">  4010bd: e8 76 02 00 00               	callq	630 &lt;strings_not_equal&gt;</span><br><span class="line">  4010c2: 85 c0                        	testl	%eax, %eax</span><br><span class="line">  4010c4: 74 13                        	je	19 &lt;phase_5+0x77&gt;  # 0x4010d9</span><br><span class="line">  4010c6: e8 6f 03 00 00               	callq	879 &lt;explode_bomb&gt;</span><br><span class="line">  4010cb: 0f 1f 44 00 00               	nopl	(%rax,%rax)</span><br><span class="line">  4010d0: eb 07                        	jmp	7 &lt;phase_5+0x77&gt;  # 0x4010d9</span><br><span class="line">  4010d2: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  4010d7: eb b2                        	jmp	-78 &lt;phase_5+0x29&gt;  # 0x40108b</span><br><span class="line">  4010d9: 48 8b 44 24 18               	movq	24(%rsp), %rax</span><br><span class="line">  4010de: 64 48 33 04 25 28 00 00 00   	xorq	%fs:40, %rax</span><br><span class="line">  4010e7: 74 05                        	je	5 &lt;phase_5+0x8c&gt;  # 0x4010ee</span><br><span class="line">  4010e9: e8 42 fa ff ff               	callq	-1470 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee: 48 83 c4 20                  	addq	$32, %rsp</span><br><span class="line">  4010f2: 5b                           	popq	%rbx</span><br><span class="line">  4010f3: c3                           	retq</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>还是C语言相较于汇编容易理解一些。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">phase_5(input) &#123;</span><br><span class="line">    %rbx = input;</span><br><span class="line">    </span><br><span class="line">    %eax = <span class="built_in">strlen</span>(input);</span><br><span class="line">    <span class="keyword">if</span> (%eax  != <span class="number">6</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    %eax = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    %ecx = *(%rbx + %rax);</span><br><span class="line">    %edx = *((%cl &amp; <span class="number">0xf</span>) + <span class="number">4203696</span>);</span><br><span class="line">    *(%rsp + %rax + <span class="number">16</span>) = %dl;</span><br><span class="line">    %rax++;</span><br><span class="line">&#125; <span class="keyword">while</span> (%rax != <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    *(%rsp + <span class="number">22</span>) = <span class="number">0</span>;</span><br><span class="line">    %eax = strings_not_equal(*(%rsp + <span class="number">16</span>), <span class="number">4203614</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (%eax != <span class="number">0</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有一部分看着很奇怪的指令组合。在stack overflow上有类似的讨论<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12234817/what-does-this-instruction-do-mov-gs0x14-eax">what does this instruction do?:- mov %gs:0x14,%eax</a>。忽略它。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">40106</span>a: <span class="number">64</span> <span class="number">48</span> <span class="number">8b</span> <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>   	movq	%fs:<span class="number">40</span>, %rax</span><br><span class="line"><span class="number">401073</span>: <span class="number">48</span> <span class="number">89</span> <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>               	movq	%rax, <span class="number">24</span>(%rsp)</span><br><span class="line"><span class="number">401078</span>: <span class="number">31</span> c0                        	xorl	%eax, %eax</span><br><span class="line"><span class="number">4010</span>d9: <span class="number">48</span> <span class="number">8b</span> <span class="number">44</span> <span class="number">24</span> <span class="number">18</span>               	movq	<span class="number">24</span>(%rsp), %rax</span><br><span class="line"><span class="number">4010</span>de: <span class="number">64</span> <span class="number">48</span> <span class="number">33</span> <span class="number">04</span> <span class="number">25</span> <span class="number">28</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>   	xorq	%fs:<span class="number">40</span>, %rax</span><br><span class="line"><span class="number">4010e7</span>: <span class="number">74</span> <span class="number">05</span>                        	je	<span class="number">5</span> &lt;phase_5+<span class="number">0x8c</span>&gt;  # <span class="number">0x4010ee</span></span><br><span class="line"><span class="number">4010e9</span>: e8 <span class="number">42</span> fa ff ff               	callq	<span class="number">-1470</span> &lt;__stack_chk_fail@plt&gt;</span><br></pre></td></tr></table></figure>

<p>先看一下地址4203614（0x40245e）的信息，可以得到一个字符串“flyers”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">402450 73656372 65742073 74616765 2100666c  secret stage!.fl</span><br><span class="line">402460 79657273 00000000 00000000 00000000  yers............</span><br></pre></td></tr></table></figure>

<p>然后看一下地址4203696（0x4024b0）的信息，可以看到一个很长的字符串，但是由于我们仅需要15个字符（偏移量最大为15），因此从中提取6个字符“maduiersnfotvbyl”。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4024b0 6d616475 69657273 6e666f74 7662796c  maduiersnfotvbyl</span><br><span class="line">4024c0 536f2079 6f752074 68696e6b 20796f75  So you think you</span><br></pre></td></tr></table></figure>

<p>也就是说我们要根据input的信息和字符串“maduiersnfotvbyl”进过函数内的处理得到字符串“flyers”。</p>
<p>首先找到所需字母分别对应的位置。<code>&#123;&#39;f&#39;: 0x9, &#39;l&#39;: 0xf, &#39;y&#39;: 0xe, &#39;e&#39;: 0x5, &#39;r&#39;: 0x6, &#39;s&#39;: 0x7&#125;</code>。因此我们构造的输入需要低4位分别是上述数字的字符。</p>
<p>用python打印出所有小写字母对应的ascii码值，根据这个结果构造输入“ionefg”。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">18</span>]: <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">26</span>):</span><br><span class="line">    ...:     <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;<span class="built_in">chr</span>(i + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))&#125;</span> -&gt; hex <span class="subst">&#123;<span class="built_in">hex</span>(i + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))&#125;</span>&quot;</span>)</span><br><span class="line">    ...:</span><br><span class="line">a -&gt; <span class="built_in">hex</span> <span class="number">0x61</span></span><br><span class="line">b -&gt; <span class="built_in">hex</span> <span class="number">0x62</span></span><br><span class="line">c -&gt; <span class="built_in">hex</span> <span class="number">0x63</span></span><br><span class="line">d -&gt; <span class="built_in">hex</span> <span class="number">0x64</span></span><br><span class="line">e -&gt; <span class="built_in">hex</span> <span class="number">0x65</span></span><br><span class="line">f -&gt; <span class="built_in">hex</span> <span class="number">0x66</span></span><br><span class="line">g -&gt; <span class="built_in">hex</span> <span class="number">0x67</span></span><br><span class="line">h -&gt; <span class="built_in">hex</span> <span class="number">0x68</span></span><br><span class="line">i -&gt; <span class="built_in">hex</span> <span class="number">0x69</span></span><br><span class="line">j -&gt; <span class="built_in">hex</span> <span class="number">0x6a</span></span><br><span class="line">k -&gt; <span class="built_in">hex</span> <span class="number">0x6b</span></span><br><span class="line">l -&gt; <span class="built_in">hex</span> <span class="number">0x6c</span></span><br><span class="line">m -&gt; <span class="built_in">hex</span> <span class="number">0x6d</span></span><br><span class="line">n -&gt; <span class="built_in">hex</span> <span class="number">0x6e</span></span><br><span class="line">o -&gt; <span class="built_in">hex</span> <span class="number">0x6f</span></span><br><span class="line">p -&gt; <span class="built_in">hex</span> <span class="number">0x70</span></span><br><span class="line">q -&gt; <span class="built_in">hex</span> <span class="number">0x71</span></span><br><span class="line">r -&gt; <span class="built_in">hex</span> <span class="number">0x72</span></span><br><span class="line">s -&gt; <span class="built_in">hex</span> <span class="number">0x73</span></span><br><span class="line">t -&gt; <span class="built_in">hex</span> <span class="number">0x74</span></span><br><span class="line">u -&gt; <span class="built_in">hex</span> <span class="number">0x75</span></span><br><span class="line">v -&gt; <span class="built_in">hex</span> <span class="number">0x76</span></span><br><span class="line">w -&gt; <span class="built_in">hex</span> <span class="number">0x77</span></span><br><span class="line">x -&gt; <span class="built_in">hex</span> <span class="number">0x78</span></span><br><span class="line">y -&gt; <span class="built_in">hex</span> <span class="number">0x79</span></span><br><span class="line">z -&gt; <span class="built_in">hex</span> <span class="number">0x7a</span></span><br></pre></td></tr></table></figure>



<h2 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase 6"></a>Phase 6</h2><p>这应该是最为困难的一个阶段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 phase_6:</span><br><span class="line">  4010f4: 41 56                        	pushq	%r14</span><br><span class="line">  4010f6: 41 55                        	pushq	%r13</span><br><span class="line">  4010f8: 41 54                        	pushq	%r12</span><br><span class="line">  4010fa: 55                           	pushq	%rbp</span><br><span class="line">  4010fb: 53                           	pushq	%rbx</span><br><span class="line">  4010fc: 48 83 ec 50                  	subq	$80, %rsp</span><br><span class="line">  401100: 49 89 e5                     	movq	%rsp, %r13</span><br><span class="line">  401103: 48 89 e6                     	movq	%rsp, %rsi</span><br><span class="line">  401106: e8 51 03 00 00               	callq	849 &lt;read_six_numbers&gt;</span><br><span class="line">  40110b: 49 89 e6                     	movq	%rsp, %r14</span><br><span class="line">  40110e: 41 bc 00 00 00 00            	movl	$0, %r12d</span><br><span class="line">  401114: 4c 89 ed                     	movq	%r13, %rbp</span><br><span class="line">  401117: 41 8b 45 00                  	movl	(%r13), %eax</span><br><span class="line">  40111b: 83 e8 01                     	subl	$1, %eax</span><br><span class="line">  40111e: 83 f8 05                     	cmpl	$5, %eax</span><br><span class="line">  401121: 76 05                        	jbe	5 &lt;phase_6+0x34&gt;  # 0x401128</span><br><span class="line">  401123: e8 12 03 00 00               	callq	786 &lt;explode_bomb&gt;</span><br><span class="line">  401128: 41 83 c4 01                  	addl	$1, %r12d</span><br><span class="line">  40112c: 41 83 fc 06                  	cmpl	$6, %r12d</span><br><span class="line">  401130: 74 21                        	je	33 &lt;phase_6+0x5f&gt;  # 0x401153</span><br><span class="line">  401132: 44 89 e3                     	movl	%r12d, %ebx</span><br><span class="line">  401135: 48 63 c3                     	movslq	%ebx, %rax</span><br><span class="line">  401138: 8b 04 84                     	movl	(%rsp,%rax,4), %eax</span><br><span class="line">  40113b: 39 45 00                     	cmpl	%eax, (%rbp)</span><br><span class="line">  40113e: 75 05                        	jne	5 &lt;phase_6+0x51&gt;  # 0x401145</span><br><span class="line">  401140: e8 f5 02 00 00               	callq	757 &lt;explode_bomb&gt;</span><br><span class="line">  401145: 83 c3 01                     	addl	$1, %ebx</span><br><span class="line">  401148: 83 fb 05                     	cmpl	$5, %ebx</span><br><span class="line">  40114b: 7e e8                        	jle	-24 &lt;phase_6+0x41&gt;  # 0x401135</span><br><span class="line">  40114d: 49 83 c5 04                  	addq	$4, %r13</span><br><span class="line">  401151: eb c1                        	jmp	-63 &lt;phase_6+0x20&gt;  # 0x401114</span><br><span class="line">  401153: 48 8d 74 24 18               	leaq	24(%rsp), %rsi</span><br><span class="line">  401158: 4c 89 f0                     	movq	%r14, %rax</span><br><span class="line">  40115b: b9 07 00 00 00               	movl	$7, %ecx</span><br><span class="line">  401160: 89 ca                        	movl	%ecx, %edx</span><br><span class="line">  401162: 2b 10                        	subl	(%rax), %edx</span><br><span class="line">  401164: 89 10                        	movl	%edx, (%rax)</span><br><span class="line">  401166: 48 83 c0 04                  	addq	$4, %rax</span><br><span class="line">  40116a: 48 39 f0                     	cmpq	%rsi, %rax</span><br><span class="line">  40116d: 75 f1                        	jne	-15 &lt;phase_6+0x6c&gt;  # 0x401160</span><br><span class="line">  40116f: be 00 00 00 00               	movl	$0, %esi</span><br><span class="line">  401174: eb 21                        	jmp	33 &lt;phase_6+0xa3&gt;  # 0x401197</span><br><span class="line">  401176: 48 8b 52 08                  	movq	8(%rdx), %rdx</span><br><span class="line">  40117a: 83 c0 01                     	addl	$1, %eax</span><br><span class="line">  40117d: 39 c8                        	cmpl	%ecx, %eax</span><br><span class="line">  40117f: 75 f5                        	jne	-11 &lt;phase_6+0x82&gt;  # 0x401176</span><br><span class="line">  401181: eb 05                        	jmp	5 &lt;phase_6+0x94&gt;  # 0x401188</span><br><span class="line">  401183: ba d0 32 60 00               	movl	$6304464, %edx</span><br><span class="line">  401188: 48 89 54 74 20               	movq	%rdx, 32(%rsp,%rsi,2)</span><br><span class="line">  40118d: 48 83 c6 04                  	addq	$4, %rsi</span><br><span class="line">  401191: 48 83 fe 18                  	cmpq	$24, %rsi</span><br><span class="line">  401195: 74 14                        	je	20 &lt;phase_6+0xb7&gt;  # 0x4011ab</span><br><span class="line">  401197: 8b 0c 34                     	movl	(%rsp,%rsi), %ecx</span><br><span class="line">  40119a: 83 f9 01                     	cmpl	$1, %ecx</span><br><span class="line">  40119d: 7e e4                        	jle	-28 &lt;phase_6+0x8f&gt;  # 0x401183</span><br><span class="line">  40119f: b8 01 00 00 00               	movl	$1, %eax</span><br><span class="line">  4011a4: ba d0 32 60 00               	movl	$6304464, %edx</span><br><span class="line">  4011a9: eb cb                        	jmp	-53 &lt;phase_6+0x82&gt;  # 0x401176</span><br><span class="line">  4011ab: 48 8b 5c 24 20               	movq	32(%rsp), %rbx</span><br><span class="line">  4011b0: 48 8d 44 24 28               	leaq	40(%rsp), %rax</span><br><span class="line">  4011b5: 48 8d 74 24 50               	leaq	80(%rsp), %rsi</span><br><span class="line">  4011ba: 48 89 d9                     	movq	%rbx, %rcx</span><br><span class="line">  4011bd: 48 8b 10                     	movq	(%rax), %rdx</span><br><span class="line">  4011c0: 48 89 51 08                  	movq	%rdx, 8(%rcx)</span><br><span class="line">  4011c4: 48 83 c0 08                  	addq	$8, %rax</span><br><span class="line">  4011c8: 48 39 f0                     	cmpq	%rsi, %rax</span><br><span class="line">  4011cb: 74 05                        	je	5 &lt;phase_6+0xde&gt;  # 0x4011d2</span><br><span class="line">  4011cd: 48 89 d1                     	movq	%rdx, %rcx</span><br><span class="line">  4011d0: eb eb                        	jmp	-21 &lt;phase_6+0xc9&gt;  # 0x4011bd</span><br><span class="line">  4011d2: 48 c7 42 08 00 00 00 00      	movq	$0, 8(%rdx)</span><br><span class="line">  4011da: bd 05 00 00 00               	movl	$5, %ebp</span><br><span class="line">  4011df: 48 8b 43 08                  	movq	8(%rbx), %rax</span><br><span class="line">  4011e3: 8b 00                        	movl	(%rax), %eax</span><br><span class="line">  4011e5: 39 03                        	cmpl	%eax, (%rbx)</span><br><span class="line">  4011e7: 7d 05                        	jge	5 &lt;phase_6+0xfa&gt;  # 0x4011ee</span><br><span class="line">  4011e9: e8 4c 02 00 00               	callq	588 &lt;explode_bomb&gt;</span><br><span class="line">  4011ee: 48 8b 5b 08                  	movq	8(%rbx), %rbx</span><br><span class="line">  4011f2: 83 ed 01                     	subl	$1, %ebp</span><br><span class="line">  4011f5: 75 e8                        	jne	-24 &lt;phase_6+0xeb&gt;  # 0x4011df</span><br><span class="line">  4011f7: 48 83 c4 50                  	addq	$80, %rsp</span><br><span class="line">  4011fb: 5b                           	popq	%rbx</span><br><span class="line">  4011fc: 5d                           	popq	%rbp</span><br><span class="line">  4011fd: 41 5c                        	popq	%r12</span><br><span class="line">  4011ff: 41 5d                        	popq	%r13</span><br><span class="line">  401201: 41 5e                        	popq	%r14</span><br><span class="line">  401203: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>手工解析成C语言代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">phase_6(input) &#123;</span><br><span class="line">    %r13 = %rsp;  <span class="comment">// 0x7fffffffea60</span></span><br><span class="line">    read_six_numbers(input, %rsp);</span><br><span class="line">    %r14 = %rsp;  <span class="comment">// 0x7fffffffea60</span></span><br><span class="line">    </span><br><span class="line">    %r12d = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        %rbp = %r13;</span><br><span class="line">    </span><br><span class="line">    	%eax = *(%r13);  <span class="comment">// 第一个数字</span></span><br><span class="line">    	%eax--;</span><br><span class="line">    </span><br><span class="line">    	<span class="keyword">if</span> (%eax &gt; <span class="number">5</span>) &#123;</span><br><span class="line">     	   explode_bomb();</span><br><span class="line">    	&#125;</span><br><span class="line">    </span><br><span class="line">        %r12d++;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (%r12d == <span class="number">6</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        %ebx = %r12d;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            %rax = %ebx;</span><br><span class="line">            %eax = *(%rsp + %rax * <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">if</span> (*(%rbp) == %eax) &#123;</span><br><span class="line">                explode_bomb();</span><br><span class="line">            &#125;</span><br><span class="line">            %ebx++;</span><br><span class="line">        &#125; <span class="keyword">while</span> (%ebx &lt;= <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        %r13 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* 直到此处，可以看出，要求这六个数都小于等于6，并且它们各不相同 */</span></span><br><span class="line">    </span><br><span class="line">    %rsi = *(%rsp + <span class="number">24</span>);</span><br><span class="line">    %rax = %r14;</span><br><span class="line">    %ecx = <span class="number">7</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">    	%edx = %ecx - *(%rax);</span><br><span class="line">    	*(%rax) = %edx;</span><br><span class="line">    	%rax += <span class="number">4</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (%rax != %rsi);</span><br><span class="line">    <span class="comment">/* 将六个数修改为与7的差值 */</span></span><br><span class="line">    </span><br><span class="line">    %esi = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        %ecx = *(%rsp + %rsi);</span><br><span class="line">        <span class="keyword">if</span> (%ecx &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            %edx = <span class="number">6304464</span>;  <span class="comment">// 这一块的解析在下面</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            %eax = <span class="number">1</span>;</span><br><span class="line">            %edx = <span class="number">6304464</span>;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                %rdx = *(%rdx + <span class="number">8</span>);</span><br><span class="line">                %eax++;</span><br><span class="line">            &#125; <span class="keyword">while</span> (%eax != %ecx);</span><br><span class="line">            <span class="comment">/* 从6304464逐渐往后遍历，p = p-&gt;next */</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        *(%rsp + %rsi * <span class="number">2</span> + <span class="number">32</span>) = %rdx;  <span class="comment">/* 将链表的value存放在 %rsp + 32的位置，每个数占8字节 */</span></span><br><span class="line">        %rsi += <span class="number">4</span>;</span><br><span class="line">    &#125; <span class="keyword">while</span> (%rsi != <span class="number">24</span>);</span><br><span class="line">    <span class="comment">/* 这里就是根据那六个数字来遍历链表，并将链表节点的地址存储在栈中 */</span></span><br><span class="line"></span><br><span class="line">	%rbx = *(%rsp + <span class="number">32</span>);  <span class="comment">/* 从链表节点数组中取出的六个值的起点值 */</span></span><br><span class="line">    %rax = %rsp + <span class="number">40</span>;  <span class="comment">/* %rsp + 4 * 2 + 32 */</span></span><br><span class="line">    %rsi = %rsp + <span class="number">80</span>;</span><br><span class="line">	%rcx = %rbx;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        %rdx = *(%rax);</span><br><span class="line">        *(%rcx + <span class="number">8</span>) = %rdx;</span><br><span class="line">        %rax += <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">if</span> (%rax == %rsi) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        %rcx = %rdx;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">/* 此处在把这6个链表节点连接起来 */</span> </span><br><span class="line">    </span><br><span class="line">    *(%rdx + <span class="number">8</span>) = <span class="number">0</span>;  <span class="comment">/* 设置最后一个节点的next为p-&gt;next = NULL */</span></span><br><span class="line">    %ebp = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        %rax = *(%rbx + <span class="number">8</span>);  <span class="comment">/* rbx的初值还是节点数组的第一个值 */</span></span><br><span class="line">        %eax = *(%rax);</span><br><span class="line">        <span class="keyword">if</span> (*(%rbx) &lt; %eax) &#123; <span class="comment">/* 如果这个新链表的下一个节点的值比当前大则爆炸 */</span></span><br><span class="line">            explode_bomb();   <span class="comment">/* 因为使用指令都是l结尾的，因此把它当作一个双字整数，即long */</span></span><br><span class="line">        &#125;</span><br><span class="line">        %rbx = *(%rbx + <span class="number">8</span>);</span><br><span class="line">        %ebp--;</span><br><span class="line">    &#125; <span class="keyword">while</span> (*(%rbx) != %eax);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之前的常量都在rodata区，但是6304464这个地址却是data区的，通过gdb将其打印出来。结合<code>%rdx = *(%rdx + 8);</code>可以看出每一个该位置的值，都是下一个位置的地址。大概可以猜测此处是一个类似链表的结构。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/24xw 6304464</span><br><span class="line">0x6032d0 &lt;node1&gt;:	0x0000014c	0x00000001	0x006032e0	0x00000000</span><br><span class="line">0x6032e0 &lt;node2&gt;:	0x000000a8	0x00000002	0x006032f0	0x00000000</span><br><span class="line">0x6032f0 &lt;node3&gt;:	0x0000039c	0x00000003	0x00603300	0x00000000</span><br><span class="line">0x603300 &lt;node4&gt;:	0x000002b3	0x00000004	0x00603310	0x00000000</span><br><span class="line">0x603310 &lt;node5&gt;:	0x000001dd	0x00000005	0x00603320	0x00000000</span><br><span class="line">0x603320 &lt;node6&gt;:	0x000001bb	0x00000006	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<p>经过分析，其实代码流程已经很清楚了。从input读取六个数，保证它们均小于等于6，并且各不相同；然后将他们的值设为与7的差值；接着根据处理后的这六个数，对链表节点进行重排序，保证新的链表是一个非严格的递减序列。</p>
<p>从上述链表节点的值可以看出，构造的新链表的顺序为3，4，5，6，1，2。因此对应的原六个数分别是4，3，2，1，6，5。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412161144084.png" class="">

<p>至此拆弹完成，但是真的吗？根据bomb.c最后部分的内容以及汇编代码中看到fun7和secret_phase可以猜测，还有一个隐藏关。</p>
<h2 id="Secret-Phase"><a href="#Secret-Phase" class="headerlink" title="Secret Phase"></a>Secret Phase</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000401242 secret_phase:</span><br><span class="line">  401242: 53                           	pushq	%rbx</span><br><span class="line">  401243: e8 56 02 00 00               	callq	598 &lt;read_line&gt;</span><br><span class="line">  401248: ba 0a 00 00 00               	movl	$10, %edx</span><br><span class="line">  40124d: be 00 00 00 00               	movl	$0, %esi</span><br><span class="line">  401252: 48 89 c7                     	movq	%rax, %rdi</span><br><span class="line">  401255: e8 76 f9 ff ff               	callq	-1674 &lt;strtol@plt&gt;</span><br><span class="line">  40125a: 48 89 c3                     	movq	%rax, %rbx</span><br><span class="line">  40125d: 8d 40 ff                     	leal	-1(%rax), %eax</span><br><span class="line">  401260: 3d e8 03 00 00               	cmpl	$1000, %eax</span><br><span class="line">  401265: 76 05                        	jbe	5 &lt;secret_phase+0x2a&gt;  # 0x40126c</span><br><span class="line">  401267: e8 ce 01 00 00               	callq	462 &lt;explode_bomb&gt;</span><br><span class="line">  40126c: 89 de                        	movl	%ebx, %esi</span><br><span class="line">  40126e: bf f0 30 60 00               	movl	$6303984, %edi</span><br><span class="line">  401273: e8 8c ff ff ff               	callq	-116 &lt;fun7&gt;</span><br><span class="line">  401278: 83 f8 02                     	cmpl	$2, %eax</span><br><span class="line">  40127b: 74 05                        	je	5 &lt;secret_phase+0x40&gt;  # 0x401282</span><br><span class="line">  40127d: e8 b8 01 00 00               	callq	440 &lt;explode_bomb&gt;</span><br><span class="line">  401282: bf 38 24 40 00               	movl	$4203576, %edi</span><br><span class="line">  401287: e8 84 f8 ff ff               	callq	-1916 &lt;puts@plt&gt;</span><br><span class="line">  40128c: e8 33 03 00 00               	callq	819 &lt;phase_defused&gt;</span><br><span class="line">  401291: 5b                           	popq	%rbx</span><br><span class="line">  401292: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>对其进行分析：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">secret_phase(input) &#123;</span><br><span class="line">    %rax = strtol(input, <span class="number">0</span>, <span class="number">10</span>);  <span class="comment">// long int strtol(const char *str, char **endptr, int base)</span></span><br><span class="line">    %rbx = %rax;</span><br><span class="line">    %eax = %rax - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (%rax &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    %eax = fun7(<span class="number">6303984</span>, %ebx);</span><br><span class="line">    <span class="keyword">if</span> (%eax != <span class="number">2</span>) &#123;</span><br><span class="line">        explode_bomb();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">puts</span>(<span class="number">4203576</span>);</span><br><span class="line">    phase_defused();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看得出，从字符串中读取一个数，保证其小于等于1001。然后放入fun7函数处理，要使得fun7的返回值为2。</p>
<p>进一步关注fun7的内容。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0000000000401204 fun7:</span><br><span class="line">  401204: 48 83 ec 08                  	subq	$8, %rsp</span><br><span class="line">  401208: 48 85 ff                     	testq	%rdi, %rdi</span><br><span class="line">  40120b: 74 2b                        	je	43 &lt;fun7+0x34&gt;  # 0x401238</span><br><span class="line">  40120d: 8b 17                        	movl	(%rdi), %edx</span><br><span class="line">  40120f: 39 f2                        	cmpl	%esi, %edx</span><br><span class="line">  401211: 7e 0d                        	jle	13 &lt;fun7+0x1c&gt;  # 0x401220</span><br><span class="line">  401213: 48 8b 7f 08                  	movq	8(%rdi), %rdi</span><br><span class="line">  401217: e8 e8 ff ff ff               	callq	-24 &lt;fun7&gt;</span><br><span class="line">  40121c: 01 c0                        	addl	%eax, %eax</span><br><span class="line">  40121e: eb 1d                        	jmp	29 &lt;fun7+0x39&gt;  # 0x40123d</span><br><span class="line">  401220: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  401225: 39 f2                        	cmpl	%esi, %edx</span><br><span class="line">  401227: 74 14                        	je	20 &lt;fun7+0x39&gt;  # 0x40123d</span><br><span class="line">  401229: 48 8b 7f 10                  	movq	16(%rdi), %rdi</span><br><span class="line">  40122d: e8 d2 ff ff ff               	callq	-46 &lt;fun7&gt;</span><br><span class="line">  401232: 8d 44 00 01                  	leal	1(%rax,%rax), %eax</span><br><span class="line">  401236: eb 05                        	jmp	5 &lt;fun7+0x39&gt;  # 0x40123d</span><br><span class="line">  401238: b8 ff ff ff ff               	movl	$4294967295, %eax</span><br><span class="line">  40123d: 48 83 c4 08                  	addq	$8, %rsp</span><br><span class="line">  401241: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>对其进行解析：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">fun7(<span class="type">void</span> *p, <span class="type">int</span> x) &#123;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0xffffffff</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (p-&gt;value &lt;= x) &#123;</span><br><span class="line">        r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (p-&gt;value  == x) &#123;</span><br><span class="line">            <span class="keyword">return</span> r;</span><br><span class="line">        &#125;</span><br><span class="line">        p = p-&gt;right;</span><br><span class="line">        r = fun7(p, x);</span><br><span class="line">        r = <span class="number">2</span> * r + <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        p = p-&gt;left;</span><br><span class="line">        r = fun7(p, x);</span><br><span class="line">        r *= <span class="number">2</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看得出fun7的主要功能是在链表中搜索x，并返回搜索的次数。</p>
<p>地址6303984处的部分值如下。从这个值分布可以看出，这应该是一个二叉树的节点，一个节点里面包含一个value，以及两个地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/40xw 0x6030f0</span><br><span class="line">0x6030f0 &lt;n1&gt;:		0x00000024	0x00000000	0x00603110	0x00000000</span><br><span class="line">0x603100 &lt;n1+16&gt;:	0x00603130	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x603110 &lt;n21&gt;:		0x00000008	0x00000000	0x00603190	0x00000000</span><br><span class="line">0x603120 &lt;n21+16&gt;:	0x00603150	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x603130 &lt;n22&gt;:		0x00000032	0x00000000	0x00603170	0x00000000</span><br><span class="line">0x603140 &lt;n22+16&gt;:	0x006031b0	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x603150 &lt;n32&gt;:		0x00000016	0x00000000	0x00603270	0x00000000</span><br><span class="line">0x603160 &lt;n32+16&gt;:	0x00603230	0x00000000	0x00000000	0x00000000</span><br><span class="line">0x603170 &lt;n33&gt;:		0x0000002d	0x00000000	0x006031d0	0x00000000</span><br><span class="line">0x603180 &lt;n33+16&gt;:	0x00603290	0x00000000	0x00000000	0x00000000</span><br></pre></td></tr></table></figure>

<p>需求都已经很明晰了，构造这么一个特殊的输入即可。</p>
<p>我们已经知道了隐藏关的通过值，但是进入隐藏关的方法还需要进一步分析。通过搜索，可以得知，在phase_defused中会调用隐藏关。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">00000000004015c4 phase_defused:</span><br><span class="line">  4015c4: 48 83 ec 78                  	subq	$120, %rsp</span><br><span class="line">  4015c8: 64 48 8b 04 25 28 00 00 00   	movq	%fs:40, %rax</span><br><span class="line">  4015d1: 48 89 44 24 68               	movq	%rax, 104(%rsp)</span><br><span class="line">  4015d6: 31 c0                        	xorl	%eax, %eax</span><br><span class="line">  4015d8: 83 3d 81 21 20 00 06         	cmpl	$6, 2105729(%rip)</span><br><span class="line">  4015df: 75 5e                        	jne	94 &lt;phase_defused+0x7b&gt;  # 0x40163f</span><br><span class="line">  4015e1: 4c 8d 44 24 10               	leaq	16(%rsp), %r8</span><br><span class="line">  4015e6: 48 8d 4c 24 0c               	leaq	12(%rsp), %rcx</span><br><span class="line">  4015eb: 48 8d 54 24 08               	leaq	8(%rsp), %rdx</span><br><span class="line">  4015f0: be 19 26 40 00               	movl	$4204057, %esi  # &quot;%d %d %s&quot;</span><br><span class="line">  4015f5: bf 70 38 60 00               	movl	$6305904, %edi</span><br><span class="line">  4015fa: e8 f1 f5 ff ff               	callq	-2575 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">  4015ff: 83 f8 03                     	cmpl	$3, %eax</span><br><span class="line">  401602: 75 31                        	jne	49 &lt;phase_defused+0x71&gt;  # 0x401635</span><br><span class="line">  401604: be 22 26 40 00               	movl	$4204066, %esi  # &quot;DrEvil&quot;</span><br><span class="line">  401609: 48 8d 7c 24 10               	leaq	16(%rsp), %rdi</span><br><span class="line">  40160e: e8 25 fd ff ff               	callq	-731 &lt;strings_not_equal&gt;</span><br><span class="line">  401613: 85 c0                        	testl	%eax, %eax</span><br><span class="line">  401615: 75 1e                        	jne	30 &lt;phase_defused+0x71&gt;  # 0x401635</span><br><span class="line">  401617: bf f8 24 40 00               	movl	$4203768, %edi</span><br><span class="line">  40161c: e8 ef f4 ff ff               	callq	-2833 &lt;puts@plt&gt;</span><br><span class="line">  401621: bf 20 25 40 00               	movl	$4203808, %edi</span><br><span class="line">  401626: e8 e5 f4 ff ff               	callq	-2843 &lt;puts@plt&gt;</span><br><span class="line">  40162b: b8 00 00 00 00               	movl	$0, %eax</span><br><span class="line">  401630: e8 0d fc ff ff               	callq	-1011 &lt;secret_phase&gt;</span><br><span class="line">  401635: bf 58 25 40 00               	movl	$4203864, %edi</span><br><span class="line">  40163a: e8 d1 f4 ff ff               	callq	-2863 &lt;puts@plt&gt;</span><br><span class="line">  40163f: 48 8b 44 24 68               	movq	104(%rsp), %rax</span><br><span class="line">  401644: 64 48 33 04 25 28 00 00 00   	xorq	%fs:40, %rax</span><br><span class="line">  40164d: 74 05                        	je	5 &lt;phase_defused+0x90&gt; # 0x401654</span><br><span class="line">  40164f: e8 dc f4 ff ff               	callq	-2852 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  401654: 48 83 c4 78                  	addq	$120, %rsp</span><br><span class="line">  401658: c3                           	retq</span><br></pre></td></tr></table></figure>

<p>这个就不翻了，逻辑挺简单的，从6305904的位置中读取两个数和一个字符串，然后将字符串与4204066地址的串进行比较，如果通过了就进入secret_phase。</p>
<p>因此关键的是6305904的位置是哪里。通过gdb查看该部分的内存，可以猜测，这可能是input的某个部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/16xb 6305904</span><br><span class="line">0x603870 &lt;input_strings+240&gt;:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br><span class="line">0x603878 &lt;input_strings+248&gt;:	0x00	0x00	0x00	0x00	0x00	0x00	0x00	0x00</span><br></pre></td></tr></table></figure>

<p>通过gdb的watch功能，来设置一个内存地址的监测点。通过gdb的输出，可以猜测是phase 4的地方操作了这个地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) watch *6305904</span><br><span class="line">Hardware watchpoint 2: *6305904</span><br><span class="line">(gdb) r</span><br><span class="line">The program being debugged has been started already.</span><br><span class="line">Start it from the beginning? (y or n) y</span><br><span class="line">Starting program: /home/bingo/Workdir/bomb/bomb input.file</span><br><span class="line">Welcome to my fiendish little bomb. You have 6 phases with</span><br><span class="line">which to blow yourself up. Have a nice day!</span><br><span class="line">Phase 1 defused. How about the next one?</span><br><span class="line">That&#x27;s number 2.  Keep going!</span><br><span class="line">Halfway there!</span><br><span class="line"></span><br><span class="line">Hardware watchpoint 2: *6305904</span><br><span class="line"></span><br><span class="line">Old value = 0</span><br><span class="line">New value = 170926135</span><br><span class="line">__memcpy_sse2 () at ../sysdeps/x86_64/multiarch/../memcpy.S:98</span><br><span class="line">98	../sysdeps/x86_64/multiarch/../memcpy.S: No such file or directory.</span><br></pre></td></tr></table></figure>

<p>进一步进行单步调试，在phase 4的阶段调用read_line函数，操作了地址6305904。</p>
<img src="/2021/04/12/CSAPP-Lab-Bomb-Lab/image-20210412181935636.png" class="">

<p>至此，已经可以知道进入隐藏关的方法，以及隐藏关的通关指令。</p>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h2><h3 id="GDB工具"><a href="#GDB工具" class="headerlink" title="GDB工具"></a>GDB工具</h3><p>如果自己的输入有问题，或者说查看各个函数输入的值，可以试试gdb工具进行反汇编调试。</p>
<p>相关命令参考文档<a target="_blank" rel="noopener" href="https://blog.csdn.net/moonsheep_liu/article/details/39099969">GDB调试命令（二）—反汇编相关</a>。</p>
<blockquote>
<p>ps：上面的题其实都可以用gdb来“作弊”，因为大多都涉及比较，可以直接通过设置断点来查看寄存器的值。</p>
</blockquote>
<h2 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h2><ol>
<li>Border relations with Canada have never been better.</li>
<li>1 2 4 8 16 32</li>
<li>0 207</li>
<li>7 0 DrEvil</li>
<li>ionefg</li>
<li>4 3 2 1 6 5</li>
<li>22</li>
</ol>
</div><div class="article-licensing box"><div class="licensing-title"><p>CSAPP Lab -- Bomb Lab</p><p><a href="https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/">https://rlyown.github.io/2021/04/12/CSAPP-Lab-Bomb-Lab/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Chaos Chen</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2021-04-12</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2023-06-30</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/CSAPP/">CSAPP</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/04/17/CSAPP-Lab-Attack-Lab/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">CSAPP Lab -- Attack Lab</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/04/06/CSAPP-Lab-Data-Lab/"><span class="level-item">CSAPP Lab -- Data Lab</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comentarios</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "84b89aa324608da73b75be8ed5f948ee",
            repo: "rlyown.github.io",
            owner: "Rlyown",
            clientID: "0dc9a246a80c473e7d31",
            clientSecret: "08612f9152910db6288e61191a4221bad6aea8e5",
            admin: ["Rlyown"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catálogo</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Phase-1"><span class="level-left"><span class="level-item">1</span><span class="level-item">Phase 1</span></span></a></li><li><a class="level is-mobile" href="#Phase-2"><span class="level-left"><span class="level-item">2</span><span class="level-item">Phase 2</span></span></a></li><li><a class="level is-mobile" href="#Phase-3"><span class="level-left"><span class="level-item">3</span><span class="level-item">Phase 3</span></span></a></li><li><a class="level is-mobile" href="#Phase-4"><span class="level-left"><span class="level-item">4</span><span class="level-item">Phase 4</span></span></a></li><li><a class="level is-mobile" href="#Phase-5"><span class="level-left"><span class="level-item">5</span><span class="level-item">Phase 5</span></span></a></li><li><a class="level is-mobile" href="#Phase-6"><span class="level-left"><span class="level-item">6</span><span class="level-item">Phase 6</span></span></a></li><li><a class="level is-mobile" href="#Secret-Phase"><span class="level-left"><span class="level-item">7</span><span class="level-item">Secret Phase</span></span></a></li><li><a class="level is-mobile" href="#Tips"><span class="level-left"><span class="level-item">8</span><span class="level-item">Tips</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#GDB工具"><span class="level-left"><span class="level-item">8.1</span><span class="level-item">GDB工具</span></span></a></li></ul></li><li><a class="level is-mobile" href="#答案"><span class="level-left"><span class="level-item">9</span><span class="level-item">答案</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/f7.png" alt="Real Own" height="28"></a><p class="is-size-7"><span>&copy; 2023 Chaos Chen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">Visitado por <span id="busuanzi_value_site_uv">0</span> usuarios</span></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-hans");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Volver arriba" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "Este sitio web utiliza cookies para mejorar su experiencia.",
          dismiss: "¡Entendido!",
          allow: "Permitir cookies",
          deny: "Descenso",
          link: "Aprende más",
          policy: "Política de cookies",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Teclea algo..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Teclea algo...","untitled":"(Sin título)","posts":"Entradas","pages":"Páginas","categories":"Categorías","tags":"Etiquetas"});
        });</script></body></html>